# 索引
定义文档，类似于SQL的`DDL`。

```
PUT {index}
{
    "aliases": {},
    "setting": {},
    "mappings": {}
}
```

# aliases
别名，类似于sql的视图
```
{
  "aliases": {
    "{alias1}": {
      "filter": {},
      "is_hidden": false,
      "is_write_index": true,
      "routing": "",
      "index_routing": "",
      "search_routing": ""
    },
    "{alias2}": {}
  }
}
```
- `aliases.{alias1}`: 名称, 可填多个
- `aliases.{alias1}.filter`: 过滤条件，定义该别名的访问文档。内容为`Query DSL`
- `aliases.{alias1}.is_hidden`: 是否隐藏
- `aliases.{alias1}.is_write_index`: 是否为写索引，即是否可写
- `aliases.{alias1}.routing`: 索引和搜索操作路由到分片的值
- `aliases.{alias1}.index_routing`: 索引操作路由到分片的值, 指定则覆盖`aliases.{alias1}.routing`
- `aliases.{alias1}.search_routing`: 搜索操作路由到分片的值, 指定则覆盖`aliases.{alias1}.routing`

# setting
索引相关设置。

创建:
```
PUT {index}
{
    "setting": {
        "index": {}
    }
}
```
查询:
`GET {index}/_settings`
修改:
```
PUT {index}/_settings
{
  "index" : {}
}
```

## 设置级别
1. 静态: 只能在创建时或关闭时更改
2. 动态: 可在使用时更改

## 重要设置

分片及副本:
- `setting.index.number_of_shards`: (仅可以在创建时设置) 主分片数
- `setting.index.number_of_replicas`: (动态) 分片副本数量，默认为`1`
- `setting.index.number_of_routing_shards`: (静态) 可路由的分片数
- `setting.index.routing_partition_size`: (仅可以在创建时设置) 自定义路由可到达的分片数，需小于`setting.index.number_of_routing_shards`或为`1`
- `setting.index.auto_expand_replicas`: (动态) 根据数据节点数自动扩展分片数

一致性:
- `setting.index.refresh_interval`: (动态) 刷新间隔，即更改数据后查询到该更改的最大时间
- `setting.index.translog`: (动态) `translog`配置，即奔溃恢复可能损失数据的最大时间
  - `sync_interval`: 同步频率, 需大于`100ms`, 默认`5s`
  - `durability`: 是否在索引、删除、更新或批操作后提交，可选`request`(默认, 每个请求提交)`async`(异步处理)
  - `flush_threshold_size`: 刷新到Lucene阈值，默认为`10GB`。(该数据不会丢失，但奔溃恢复需要时间重放)
- `setting.index.soft_deletes.retention_lease.period`: 软删除时间(即同步到副本前保留的最长时间, 若副本数据同步后掉线时间超过该时间, 则使用分片复制而不是重放操作), 默认`12h`

查询限制:
- `setting.index.max_result_window`: (动态) 查询最大文档数量，即`form+size`的最大值。默认`10000`
- `setting.index.max_docvalue_fields_search`: (动态) 查询最大`docvalue_fields`数量。默认`100`
- `setting.index.max_script_fields`: (动态) 查询最大`script_fields`数量。默认`32`
- `setting.index.max_terms_count`: (动态) 查询最大terms查询的terms数量。默认`65536`

慢日志:
- `setting.index.search.slowlog`: (动态) 慢日志
  - `include.user`: 是否包含触发用户
  - `source`: 记录`_source`的长度, 设置为`true`记录全部, 设置为数值为截断的长度, 默认`1000`
  - `reformat`: `_source`是否格式化
  - `threshold`: 时间阈值设置，默认都不启用
    - `query`: 获取文档，可配置`warn`、`info`、`debug`、`trace`的时间阈值
    - `fetch`: 获取数据源，可配置`warn`、`info`、`debug`、`trace`的时间阈值
    - `index`: 索引，可配置`warn`、`info`、`debug`、`trace`的时间阈值

排序:
- `setting.index.sort`: (仅可以在创建时设置) 数据存储于分片上的顺序，可优化查询。该项下配置可使用数组配置多个，需保证对应位置相同。
  - `field`: 字段，只允许`boolean`, `numeric`, `date`, `keyword`类型
  - `order`: 顺序, `asc`, `desc`
  - `mode`: 多字段模式, `min`, `max`
  - `missing`: 缺少数据, `_last`, `_first`

其他:
- `setting.index.codec`: (静态) 压缩
- `setting.index.mapping.coerce`: (动态) 是否强制转换数字类型，可在`mappings`针对单个字段设置
- `setting.index.mapping.ignore_malformed`: (动态) 是否忽略字段类型错误，可在`mappings`针对单个字段设置

# mappings
定义文档及其字段如何存储及索引。

[//]: # (TODO)